[{"filePath":"D:\\projects\\yusi\\frontend\\eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\postcss.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\components\\ChatWidget.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadChatHistory'. Either include it or remove the dependency array.","line":130,"column":6,"nodeType":"ArrayExpression","endLine":130,"endColumn":40,"suggestions":[{"desc":"Update the dependencies array to be: [isOpen, user, token, loadDiaries, loadChatHistory]","fix":{"range":[4235,4269],"text":"[isOpen, user, token, loadDiaries, loadChatHistory]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useRef, useEffect, useCallback } from 'react'\r\nimport { MessageCircle, X, Send, StopCircle, Loader2, Book, AtSign } from 'lucide-react'\r\nimport { Button } from './ui/Button'\r\nimport { Textarea } from './ui/Textarea'\r\nimport { cn, API_BASE } from '../utils'\r\nimport { useAuthStore } from '../store/authStore'\r\nimport { motion, AnimatePresence } from 'framer-motion'\r\nimport { toast } from 'sonner'\r\nimport { getDiaryList, type Diary as DiaryType } from '../lib'\r\n\r\ninterface Message {\r\n  id: string\r\n  role: 'user' | 'assistant'\r\n  content: string\r\n  pending?: boolean\r\n}\r\n\r\ninterface DiaryReference {\r\n  diaryId: string\r\n  title: string\r\n  entryDate: string\r\n  content: string\r\n}\r\n\r\nimport { useChatStore } from '../stores'\r\n\r\nexport const ChatWidget = () => {\r\n  const { user, token } = useAuthStore()\r\n  const { isOpen, setIsOpen, initialMessage, setInitialMessage } = useChatStore()\r\n  const [messages, setMessages] = useState<Message[]>([])\r\n  const [input, setInput] = useState('')\r\n  const [isStreaming, setIsStreaming] = useState(false)\r\n  const [isLoadingHistory, setIsLoadingHistory] = useState(false)\r\n  const [historyLoaded, setHistoryLoaded] = useState(false)\r\n  const abortControllerRef = useRef<AbortController | null>(null)\r\n  const messagesEndRef = useRef<HTMLDivElement>(null)\r\n  const textareaRef = useRef<HTMLTextAreaElement>(null)\r\n\r\n  // @æ—¥è®°é€‰æ‹©ç›¸å…³çŠ¶æ€\r\n  const [showDiaryPicker, setShowDiaryPicker] = useState(false)\r\n  const [diaries, setDiaries] = useState<DiaryType[]>([])\r\n  const [diaryReferences, setDiaryReferences] = useState<DiaryReference[]>([])\r\n  const [loadingDiaries, setLoadingDiaries] = useState(false)\r\n  const [atPosition, setAtPosition] = useState<number | null>(null)\r\n\r\n  // æ‹–åŠ¨çŠ¶æ€\r\n  const [position, setPosition] = useState({ x: 0, y: 0 })\r\n  const [isDragging, setIsDragging] = useState(false)\r\n  const dragStartPos = useRef({ x: 0, y: 0 })\r\n  const containerRef = useRef<HTMLDivElement>(null)\r\n\r\n  // ç¦»çº¿è‰ç¨¿åŠ è½½\r\n  useEffect(() => {\r\n    if (user?.userId) {\r\n      try {\r\n        const saved = localStorage.getItem(`chat_draft_${user.userId}`)\r\n        if (saved) {\r\n          const draft = JSON.parse(saved)\r\n          if (draft.input) setInput(draft.input)\r\n          if (Array.isArray(draft.diaryReferences)) setDiaryReferences(draft.diaryReferences)\r\n        }\r\n      } catch (e) {\r\n        console.error('Failed to load chat draft:', e)\r\n      }\r\n    }\r\n  }, [user?.userId])\r\n\r\n  // ç¦»çº¿è‰ç¨¿ä¿å­˜\r\n  useEffect(() => {\r\n    if (user?.userId) {\r\n      if (input || diaryReferences.length > 0) {\r\n        localStorage.setItem(`chat_draft_${user.userId}`, JSON.stringify({ input, diaryReferences }))\r\n      } else {\r\n        localStorage.removeItem(`chat_draft_${user.userId}`)\r\n      }\r\n    }\r\n  }, [input, diaryReferences, user?.userId])\r\n\r\n  // åŠ è½½æ—¥è®°åˆ—è¡¨\r\n  const loadDiaries = useCallback(async () => {\r\n    if (!user?.userId) return\r\n    setLoadingDiaries(true)\r\n    try {\r\n      const response = await getDiaryList(user.userId, 1, 20)\r\n      setDiaries(response.content)\r\n    } catch (error) {\r\n      console.error('Failed to load diaries:', error)\r\n    } finally {\r\n      setLoadingDiaries(false)\r\n    }\r\n  }, [user?.userId])\r\n\r\n  // åŠ è½½èŠå¤©å†å²\r\n  const loadChatHistory = async () => {\r\n    if (!token || historyLoaded) return\r\n\r\n    setIsLoadingHistory(true)\r\n    try {\r\n      const response = await fetch(`${API_BASE}/ai/chat/history`, {\r\n        headers: {\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n      })\r\n\r\n      if (response.ok) {\r\n        const data = await response.json()\r\n        if (data.data && Array.isArray(data.data)) {\r\n          const historyMessages: Message[] = data.data.map((msg: { role: string; content: string }, index: number) => ({\r\n            id: `history-${index}`,\r\n            role: msg.role as 'user' | 'assistant',\r\n            content: msg.content,\r\n          }))\r\n          setMessages(historyMessages)\r\n        }\r\n      }\r\n      setHistoryLoaded(true)\r\n    } catch (error) {\r\n      console.error('Failed to load chat history:', error)\r\n    } finally {\r\n      setIsLoadingHistory(false)\r\n    }\r\n  }\r\n\r\n  // å½“æ‰“å¼€èŠå¤©çª—å£æ—¶åŠ è½½å†å²è®°å½•å’Œæ—¥è®°åˆ—è¡¨\r\n  useEffect(() => {\r\n    if (isOpen && user) {\r\n      loadChatHistory()\r\n      loadDiaries()\r\n    }\r\n  }, [isOpen, user, token, loadDiaries])\r\n\r\n  useEffect(() => {\r\n    if (isOpen && initialMessage) {\r\n      setInput(initialMessage)\r\n      setInitialMessage('')\r\n      setTimeout(() => textareaRef.current?.focus(), 100)\r\n    }\r\n  }, [isOpen, initialMessage, setInitialMessage])\r\n\r\n  const scrollToBottom = () => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' })\r\n  }\r\n\r\n  useEffect(() => {\r\n    scrollToBottom()\r\n  }, [messages])\r\n\r\n  useEffect(() => {\r\n    if (textareaRef.current) {\r\n      textareaRef.current.style.height = 'auto'\r\n      textareaRef.current.style.height = `${Math.min(textareaRef.current.scrollHeight, 120)}px`\r\n    }\r\n  }, [input])\r\n\r\n  // å¤„ç†è¾“å…¥å˜åŒ–ï¼Œæ£€æµ‹@ç¬¦å·\r\n  const handleInputChange = (e: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n    const value = e.target.value\r\n    const cursorPos = e.target.selectionStart\r\n    setInput(value)\r\n\r\n    const lastAtIndex = value.lastIndexOf('@', cursorPos - 1)\r\n    if (lastAtIndex !== -1) {\r\n      const textAfterAt = value.slice(lastAtIndex + 1, cursorPos)\r\n      if (!textAfterAt.includes(' ') && !textAfterAt.includes('\\n')) {\r\n        setAtPosition(lastAtIndex)\r\n        setShowDiaryPicker(true)\r\n        return\r\n      }\r\n    }\r\n    setShowDiaryPicker(false)\r\n    setAtPosition(null)\r\n  }\r\n\r\n  // é€‰æ‹©æ—¥è®°\r\n  const handleSelectDiary = (diary: DiaryType) => {\r\n    if (atPosition === null) return\r\n\r\n    const diaryRef: DiaryReference = {\r\n      diaryId: diary.diaryId,\r\n      title: diary.title,\r\n      entryDate: diary.entryDate,\r\n      content: diary.content\r\n    }\r\n\r\n    if (!diaryReferences.find(d => d.diaryId === diary.diaryId)) {\r\n      setDiaryReferences(prev => [...prev, diaryRef])\r\n    }\r\n\r\n    const beforeAt = input.slice(0, atPosition)\r\n    const afterMatch = input.slice(textareaRef.current?.selectionStart || atPosition + 1)\r\n    setInput(`${beforeAt}${afterMatch}`)\r\n\r\n    setShowDiaryPicker(false)\r\n    setAtPosition(null)\r\n\r\n    setTimeout(() => textareaRef.current?.focus(), 0)\r\n  }\r\n\r\n  const handleRemoveDiaryRef = (diaryId: string) => {\r\n    setDiaryReferences(prev => prev.filter(d => d.diaryId !== diaryId))\r\n  }\r\n\r\n  const buildMessageContent = (): string => {\r\n    let content = input\r\n\r\n    if (diaryReferences.length > 0) {\r\n      const diaryContext = diaryReferences.map(d =>\r\n        `ã€æ—¥è®°ã€‘${d.title}\\næ—¥æœŸï¼š${d.entryDate}\\nå†…å®¹ï¼š${d.content}`\r\n      ).join('\\n\\n')\r\n      content = `${diaryContext}\\n\\n${input}`\r\n    }\r\n\r\n    return content\r\n  }\r\n\r\n  const handleSend = async () => {\r\n    const messageContent = buildMessageContent()\r\n    if (!messageContent.trim() || !user || isStreaming) return\r\n\r\n    const userMsg: Message = {\r\n      id: Date.now().toString(),\r\n      role: 'user',\r\n      content: diaryReferences.length > 0\r\n        ? `${diaryReferences.map(d => `ğŸ“„ ${d.title}`).join(' ')}\\n${input}`\r\n        : input,\r\n    }\r\n\r\n    setMessages((prev) => [...prev, userMsg])\r\n    setInput('')\r\n    setDiaryReferences([])\r\n    if (user) {\r\n      localStorage.removeItem(`chat_draft_${user.userId}`)\r\n    }\r\n    setIsStreaming(true)\r\n\r\n    const aiMsgId = (Date.now() + 1).toString()\r\n    setMessages((prev) => [\r\n      ...prev,\r\n      { id: aiMsgId, role: 'assistant', content: '', pending: true },\r\n    ])\r\n\r\n    try {\r\n      abortControllerRef.current = new AbortController()\r\n      const response = await fetch(\r\n        `${API_BASE}/ai/chat/stream?message=${encodeURIComponent(messageContent)}`,\r\n        {\r\n          headers: {\r\n            Authorization: `Bearer ${token}`,\r\n          },\r\n          signal: abortControllerRef.current.signal,\r\n        }\r\n      )\r\n\r\n      if (!response.ok) {\r\n        const contentType = response.headers.get('content-type')\r\n        if (contentType?.includes('application/json')) {\r\n          const errorData = await response.json()\r\n          const errorCode = errorData.code\r\n\r\n          if (errorCode === 42901) {\r\n            toast.error('æ‚¨æœ‰ä¸€ä¸ªAIè¯·æ±‚æ­£åœ¨å¤„ç†ä¸­ï¼Œè¯·ç­‰å¾…å®Œæˆåå†è¯•')\r\n            setMessages((prev) => prev.filter((msg) => msg.id !== aiMsgId))\r\n            return\r\n          }\r\n\r\n          throw new Error(errorData.info || 'AIæœåŠ¡è¿æ¥å¤±è´¥')\r\n        }\r\n        throw new Error('AIæœåŠ¡è¿æ¥å¤±è´¥')\r\n      }\r\n\r\n      const reader = response.body?.getReader()\r\n      const decoder = new TextDecoder()\r\n\r\n      if (!reader) throw new Error('No reader available')\r\n\r\n      let buffer = ''\r\n      while (true) {\r\n        const { done, value } = await reader.read()\r\n        if (done) {\r\n          if (buffer.length > 0) {\r\n            if (buffer.startsWith('data:')) {\r\n              const data = buffer.slice(5)\r\n              setMessages((prev) =>\r\n                prev.map((msg) =>\r\n                  msg.id === aiMsgId\r\n                    ? { ...msg, content: msg.content + data, pending: false }\r\n                    : msg\r\n                )\r\n              )\r\n            }\r\n          }\r\n          break\r\n        }\r\n\r\n        const chunk = decoder.decode(value, { stream: true })\r\n        buffer += chunk\r\n\r\n        const lines = buffer.split('\\n')\r\n        buffer = lines.pop() || ''\r\n\r\n        for (const line of lines) {\r\n          if (line.startsWith('data:')) {\r\n            const data = line.slice(5)\r\n            setMessages((prev) =>\r\n              prev.map((msg) =>\r\n                msg.id === aiMsgId\r\n                  ? { ...msg, content: msg.content + data, pending: false }\r\n                  : msg\r\n              )\r\n            )\r\n          }\r\n        }\r\n      }\r\n    } catch (error) {\r\n      if (error instanceof DOMException && error.name === 'AbortError') {\r\n        toast.info('å“åº”å·²åœæ­¢')\r\n      } else {\r\n        const message = error instanceof Error ? error.message : ''\r\n        console.error('Chat error:', error)\r\n        toast.error(message || 'è·å–å“åº”å¤±è´¥')\r\n        setMessages((prev) =>\r\n          prev.map((msg) =>\r\n            msg.id === aiMsgId\r\n              ? { ...msg, content: msg.content + '\\n[é”™è¯¯: è¿æ¥å¤±è´¥]', pending: false }\r\n              : msg\r\n          )\r\n        )\r\n      }\r\n    } finally {\r\n      setIsStreaming(false)\r\n      abortControllerRef.current = null\r\n    }\r\n  }\r\n\r\n  const handleStop = () => {\r\n    if (abortControllerRef.current) {\r\n      abortControllerRef.current.abort()\r\n      setIsStreaming(false)\r\n    }\r\n  }\r\n\r\n  const handleKeyDown = (e: React.KeyboardEvent<HTMLTextAreaElement>) => {\r\n    if (e.key === 'Enter' && !e.shiftKey) {\r\n      e.preventDefault()\r\n      if (!showDiaryPicker) {\r\n        handleSend()\r\n      }\r\n    }\r\n    if (e.key === 'Escape' && showDiaryPicker) {\r\n      setShowDiaryPicker(false)\r\n    }\r\n  }\r\n\r\n  const filteredDiaries = diaries.filter(diary => {\r\n    if (atPosition === null) return true\r\n    const searchText = input.slice(atPosition + 1, textareaRef.current?.selectionStart || 0).toLowerCase()\r\n    return diary.title.toLowerCase().includes(searchText)\r\n  })\r\n\r\n  // æ‹–åŠ¨å¤„ç†\r\n  const handlePointerDown = (e: React.PointerEvent) => {\r\n    // åªåœ¨æ ‡é¢˜æ æˆ–æ°”æ³¡ä¸Šè§¦å‘æ‹–åŠ¨\r\n    const target = e.target as HTMLElement\r\n    const isDragHandle = target.closest('[data-drag-handle]')\r\n    if (!isDragHandle) return\r\n\r\n    setIsDragging(true)\r\n    dragStartPos.current = {\r\n      x: e.clientX - position.x,\r\n      y: e.clientY - position.y\r\n    }\r\n      ; (e.target as HTMLElement).setPointerCapture(e.pointerId)\r\n  }\r\n\r\n  const handlePointerMove = (e: React.PointerEvent) => {\r\n    if (!isDragging) return\r\n\r\n    const newX = e.clientX - dragStartPos.current.x\r\n    const newY = e.clientY - dragStartPos.current.y\r\n    setPosition({ x: newX, y: newY })\r\n  }\r\n\r\n  const handlePointerUp = (e: React.PointerEvent) => {\r\n    setIsDragging(false)\r\n      ; (e.target as HTMLElement).releasePointerCapture(e.pointerId)\r\n  }\r\n\r\n  // ç‚¹å‡»æ°”æ³¡åˆ‡æ¢çŠ¶æ€\r\n  const handleBubbleClick = () => {\r\n    if (!isDragging) {\r\n      setIsOpen(!isOpen)\r\n    }\r\n  }\r\n\r\n  if (!user) return null\r\n\r\n  return (\r\n    <div\r\n      ref={containerRef}\r\n      className=\"fixed bottom-24 right-4 z-110 select-none\"\r\n      style={{\r\n        transform: `translate(${position.x}px, ${position.y}px)`,\r\n      }}\r\n      onPointerDown={handlePointerDown}\r\n      onPointerMove={handlePointerMove}\r\n      onPointerUp={handlePointerUp}\r\n      onPointerCancel={handlePointerUp}\r\n    >\r\n      <AnimatePresence>\r\n        {isOpen && (\r\n          <motion.div\r\n            initial={{ opacity: 0, scale: 0.9, y: 20 }}\r\n            animate={{ opacity: 1, scale: 1, y: 0 }}\r\n            exit={{ opacity: 0, scale: 0.9, y: 20 }}\r\n            className=\"w-[420px] h-[560px] shadow-2xl rounded-2xl overflow-hidden flex flex-col bg-background/95 backdrop-blur border border-border/50 mb-4\"\r\n          >\r\n            {/* Header - æ‹–åŠ¨æ‰‹æŸ„ */}\r\n            <div\r\n              data-drag-handle\r\n              className=\"flex items-center justify-between p-4 border-b border-border/40 bg-muted/30 cursor-grab active:cursor-grabbing\"\r\n            >\r\n              <div className=\"flex items-center gap-2\">\r\n                <div className=\"h-2 w-2 rounded-full bg-green-500 animate-pulse\" />\r\n                <span className=\"font-semibold text-sm\">å°äºˆAI</span>\r\n                <span className=\"text-xs text-muted-foreground ml-2\">è¾“å…¥ @ å¼•ç”¨æ—¥è®°</span>\r\n              </div>\r\n              <Button\r\n                variant=\"ghost\"\r\n                size=\"icon\"\r\n                className=\"h-6 w-6\"\r\n                onClick={(e) => {\r\n                  e.stopPropagation()\r\n                  setIsOpen(false)\r\n                }}\r\n              >\r\n                <X className=\"h-4 w-4\" />\r\n              </Button>\r\n            </div>\r\n\r\n            {/* Messages */}\r\n            <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\r\n              {isLoadingHistory ? (\r\n                <div className=\"flex flex-col items-center justify-center h-full text-muted-foreground text-sm space-y-2\">\r\n                  <Loader2 className=\"h-8 w-8 opacity-50 animate-spin\" />\r\n                  <p>åŠ è½½å†å²è®°å½•...</p>\r\n                </div>\r\n              ) : messages.length === 0 ? (\r\n                <div className=\"flex flex-col items-center justify-center h-full text-muted-foreground text-sm space-y-4\">\r\n                  <MessageCircle className=\"h-8 w-8 opacity-50\" />\r\n                  <p>å¼€å¯ä¸€æ®µå¯¹è¯...</p>\r\n                  <div className=\"text-xs text-muted-foreground/70 space-y-1 text-center\">\r\n                    <p>ğŸ’¡ è¾“å…¥ <span className=\"text-primary\">@</span> å¯ä»¥å¼•ç”¨ä½ çš„æ—¥è®°</p>\r\n                    <p>æŒ‰ <span className=\"text-primary\">Enter</span> å‘é€ï¼Œ<span className=\"text-primary\">Shift+Enter</span> æ¢è¡Œ</p>\r\n                  </div>\r\n                </div>\r\n              ) : null}\r\n              {messages.map((msg) => (\r\n                <div\r\n                  key={msg.id}\r\n                  className={cn(\r\n                    'flex w-full',\r\n                    msg.role === 'user' ? 'justify-end' : 'justify-start'\r\n                  )}\r\n                >\r\n                  <div\r\n                    className={cn(\r\n                      'max-w-[85%] rounded-2xl px-4 py-2.5 text-sm shadow-sm',\r\n                      msg.role === 'user'\r\n                        ? 'bg-primary text-primary-foreground rounded-br-none'\r\n                        : 'bg-muted/50 border border-border/50 rounded-bl-none'\r\n                    )}\r\n                  >\r\n                    <div className=\"whitespace-pre-wrap wrap-break-word leading-relaxed\">{msg.content}</div>\r\n                    {msg.pending && (\r\n                      <span className=\"ml-2 inline-block h-2 w-2 rounded-full bg-current animate-bounce\" />\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              ))}\r\n              <div ref={messagesEndRef} />\r\n            </div>\r\n\r\n            {/* æ—¥è®°å¼•ç”¨æ ‡ç­¾ */}\r\n            {diaryReferences.length > 0 && (\r\n              <div className=\"px-4 py-2 border-t border-border/20 bg-muted/10 flex flex-wrap gap-2\">\r\n                {diaryReferences.map((ref) => (\r\n                  <motion.div\r\n                    key={ref.diaryId}\r\n                    initial={{ opacity: 0, scale: 0.8 }}\r\n                    animate={{ opacity: 1, scale: 1 }}\r\n                    className=\"inline-flex items-center gap-1.5 px-2.5 py-1 bg-primary/10 text-primary text-xs rounded-full border border-primary/20\"\r\n                  >\r\n                    <Book className=\"w-3 h-3\" />\r\n                    <span className=\"max-w-[100px] truncate\">{ref.title}</span>\r\n                    <button\r\n                      onClick={() => handleRemoveDiaryRef(ref.diaryId)}\r\n                      className=\"ml-0.5 hover:bg-primary/20 rounded-full p-0.5 transition-colors\"\r\n                    >\r\n                      <X className=\"w-3 h-3\" />\r\n                    </button>\r\n                  </motion.div>\r\n                ))}\r\n              </div>\r\n            )}\r\n\r\n            {/* æ—¥è®°é€‰æ‹©å™¨ */}\r\n            <AnimatePresence>\r\n              {showDiaryPicker && (\r\n                <motion.div\r\n                  initial={{ opacity: 0, y: 10 }}\r\n                  animate={{ opacity: 1, y: 0 }}\r\n                  exit={{ opacity: 0, y: 10 }}\r\n                  className=\"border-t border-border/40 bg-background/95 max-h-[180px] overflow-y-auto\"\r\n                >\r\n                  <div className=\"p-2 text-xs text-muted-foreground flex items-center gap-1 border-b border-border/20\">\r\n                    <AtSign className=\"w-3 h-3\" />\r\n                    é€‰æ‹©è¦å¼•ç”¨çš„æ—¥è®°\r\n                  </div>\r\n                  {loadingDiaries ? (\r\n                    <div className=\"p-4 text-center text-muted-foreground text-sm\">\r\n                      <Loader2 className=\"w-4 h-4 animate-spin inline mr-2\" />\r\n                      åŠ è½½ä¸­...\r\n                    </div>\r\n                  ) : filteredDiaries.length === 0 ? (\r\n                    <div className=\"p-4 text-center text-muted-foreground text-sm\">\r\n                      æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æ—¥è®°\r\n                    </div>\r\n                  ) : (\r\n                    <div className=\"py-1\">\r\n                      {filteredDiaries.slice(0, 5).map((diary) => (\r\n                        <button\r\n                          key={diary.diaryId}\r\n                          onClick={() => handleSelectDiary(diary)}\r\n                          className=\"w-full text-left px-3 py-2 hover:bg-muted/50 transition-colors flex items-center gap-2\"\r\n                        >\r\n                          <Book className=\"w-4 h-4 text-primary/70 shrink-0\" />\r\n                          <div className=\"flex-1 min-w-0\">\r\n                            <div className=\"text-sm font-medium truncate\">{diary.title}</div>\r\n                            <div className=\"text-xs text-muted-foreground\">{diary.entryDate}</div>\r\n                          </div>\r\n                        </button>\r\n                      ))}\r\n                    </div>\r\n                  )}\r\n                </motion.div>\r\n              )}\r\n            </AnimatePresence>\r\n\r\n            {/* Input */}\r\n            <div className=\"p-4 border-t border-border/40 bg-background/50\">\r\n              <div className=\"relative flex items-end gap-2\">\r\n                <Textarea\r\n                  ref={textareaRef}\r\n                  value={input}\r\n                  onChange={handleInputChange}\r\n                  onKeyDown={handleKeyDown}\r\n                  placeholder=\"è¯´ç‚¹ä»€ä¹ˆå§... è¾“å…¥@å¼•ç”¨æ—¥è®°\"\r\n                  className=\"flex-1 min-h-[40px] max-h-[120px] resize-none bg-muted/30 border-border/40 focus-visible:ring-1 pr-12 py-2.5\"\r\n                  disabled={isStreaming}\r\n                  rows={1}\r\n                />\r\n                <div className=\"absolute right-2 bottom-2 flex items-center gap-1\">\r\n                  {isStreaming ? (\r\n                    <Button\r\n                      size=\"icon\"\r\n                      variant=\"danger\"\r\n                      className=\"h-8 w-8 rounded-full\"\r\n                      onClick={handleStop}\r\n                    >\r\n                      <StopCircle className=\"h-4 w-4\" />\r\n                    </Button>\r\n                  ) : (\r\n                    <Button\r\n                      size=\"icon\"\r\n                      variant=\"primary\"\r\n                      className=\"h-8 w-8 rounded-full\"\r\n                      onClick={handleSend}\r\n                      disabled={!input.trim() && diaryReferences.length === 0}\r\n                    >\r\n                      <Send className=\"h-4 w-4\" />\r\n                    </Button>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n\r\n      {/* æ°”æ³¡æŒ‰é’® - å§‹ç»ˆåœ¨å³ä¸‹è§’ */}\r\n      <motion.button\r\n        data-drag-handle\r\n        whileHover={{ scale: 1.05 }}\r\n        whileTap={{ scale: 0.95 }}\r\n        onClick={handleBubbleClick}\r\n        className=\"h-12 w-12 rounded-full bg-primary text-primary-foreground shadow-lg flex items-center justify-center hover:bg-primary/90 transition-colors ml-auto\"\r\n      >\r\n        {isOpen ? (\r\n          <X className=\"h-6 w-6\" />\r\n        ) : (\r\n          <MessageCircle className=\"h-6 w-6\" />\r\n        )}\r\n      </motion.button>\r\n    </div>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\components\\Diary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\components\\Footer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\components\\Layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\components\\LocationManager.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\components\\LocationPicker.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\components\\SoulChatWindow.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\components\\ThemeSwitcher.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\components\\admin\\AdminGuard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\components\\admin\\AdminLayout.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nD:\\projects\\yusi\\frontend\\src\\components\\admin\\AdminLayout.tsx:96:9\n  94 |             window.scrollTo(0, 0);\n  95 |         }\n> 96 |         setIsOpen(false);\n     |         ^^^^^^^^^ Avoid calling setState() directly within an effect\n  97 |     }, [pathname]);\n  98 |\n  99 |     return (","line":96,"column":9,"nodeType":null,"endLine":96,"endColumn":18}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Outlet, Link, useLocation } from \"react-router-dom\";\r\nimport { cn } from \"../../utils\";\r\nimport { LayoutDashboard, Users, FileText, Sparkles, ArrowLeft, Menu, type LucideIcon, Shield, MessageSquare } from \"lucide-react\";\r\nimport { Sheet, SheetContent, SheetTrigger } from \"../../components/ui/Sheet\";\r\nimport { Button } from \"../../components/ui/Button\";\r\nimport { useEffect, useRef, useState } from \"react\";\r\n\r\ntype NavItem = {\r\n    label: string;\r\n    href: string;\r\n    icon: LucideIcon;\r\n    description: string;\r\n};\r\n\r\nconst navItems: NavItem[] = [\r\n    { label: \"ä»ªè¡¨ç›˜\", href: \"/admin\", icon: LayoutDashboard, description: \"ç³»ç»Ÿæ¦‚è§ˆ\" },\r\n    { label: \"ç”¨æˆ·ç®¡ç†\", href: \"/admin/users\", icon: Users, description: \"ç®¡ç†ç”¨æˆ·æƒé™\" },\r\n    { label: \"åœºæ™¯å®¡æ ¸\", href: \"/admin/scenarios\", icon: FileText, description: \"å®¡æ ¸å¾…å¤„ç†åœºæ™¯\" },\r\n    { label: \"Promptç®¡ç†\", href: \"/admin/prompts\", icon: Sparkles, description: \"é…ç½®AIæç¤ºè¯\" },\r\n    { label: \"å»ºè®®ç®¡ç†\", href: \"/admin/suggestions\", icon: MessageSquare, description: \"å¤„ç†ç”¨æˆ·å»ºè®®\" },\r\n];\r\n\r\nconst SidebarContent = ({\r\n    navItems,\r\n    pathname,\r\n    onNavigate,\r\n}: {\r\n    navItems: NavItem[];\r\n    pathname: string;\r\n    onNavigate: () => void;\r\n}) => (\r\n    <div className=\"flex flex-col h-full\">\r\n        <div className=\"h-16 flex items-center px-4 md:px-6 border-b border-border\">\r\n            <Link \r\n                to=\"/\" \r\n                className=\"flex items-center gap-2 text-muted-foreground hover:text-primary transition-colors group\"\r\n                onClick={onNavigate}\r\n            >\r\n                <div className=\"p-1.5 rounded-lg bg-muted group-hover:bg-primary/10 transition-colors\">\r\n                    <ArrowLeft className=\"w-4 h-4\" />\r\n                </div>\r\n                <div className=\"flex flex-col\">\r\n                    <span className=\"font-semibold text-sm\">è¿”å›å‰å°</span>\r\n                </div>\r\n            </Link>\r\n        </div>\r\n\r\n        <div className=\"p-3 md:p-4 flex-1 overflow-y-auto\">\r\n            <div className=\"flex items-center gap-2 mb-4 px-2\">\r\n                <Shield className=\"w-4 h-4 text-primary\" />\r\n                <span className=\"text-xs font-semibold text-muted-foreground uppercase tracking-wider\">\r\n                    ç®¡ç†åå°\r\n                </span>\r\n            </div>\r\n            <nav className=\"space-y-1\">\r\n                {navItems.map((item) => {\r\n                    const isActive = pathname === item.href || (item.href !== \"/admin\" && pathname.startsWith(item.href));\r\n                    return (\r\n                        <Link\r\n                            key={item.href}\r\n                            to={item.href}\r\n                            onClick={onNavigate}\r\n                            className={cn(\r\n                                \"flex items-center gap-3 px-3 py-2.5 rounded-xl text-sm font-medium transition-all duration-200 group\",\r\n                                isActive\r\n                                    ? \"bg-primary text-primary-foreground shadow-md shadow-primary/20\"\r\n                                    : \"text-muted-foreground hover:bg-muted hover:text-foreground\"\r\n                            )}\r\n                        >\r\n                            <item.icon className={cn(\"w-4 h-4\", isActive ? \"text-primary-foreground\" : \"text-muted-foreground group-hover:text-foreground\")} />\r\n                            <div className=\"flex flex-col\">\r\n                                <span>{item.label}</span>\r\n                                <span className={cn(\"text-[10px]\", isActive ? \"text-primary-foreground/70\" : \"text-muted-foreground/70\")}>\r\n                                    {item.description}\r\n                                </span>\r\n                            </div>\r\n                        </Link>\r\n                    );\r\n                })}\r\n            </nav>\r\n        </div>\r\n    </div>\r\n);\r\n\r\nexport const AdminLayout = () => {\r\n    const { pathname } = useLocation();\r\n    const [isOpen, setIsOpen] = useState(false);\r\n    const mainRef = useRef<HTMLDivElement | null>(null);\r\n\r\n    useEffect(() => {\r\n        if (mainRef.current) {\r\n            mainRef.current.scrollTo({ top: 0, left: 0 });\r\n        } else {\r\n            window.scrollTo(0, 0);\r\n        }\r\n        setIsOpen(false);\r\n    }, [pathname]);\r\n\r\n    return (\r\n        <div className=\"flex h-screen bg-background\">\r\n            <aside className=\"hidden lg:block w-72 border-r border-border bg-card/30 backdrop-blur-xl\">\r\n                <SidebarContent navItems={navItems} pathname={pathname} onNavigate={() => setIsOpen(false)} />\r\n            </aside>\r\n\r\n            <div className=\"flex-1 flex flex-col min-w-0\">\r\n                <header className=\"lg:hidden sticky top-0 w-full h-14 border-b border-border bg-background/95 backdrop-blur-md z-50 flex items-center px-4 justify-between\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <Sheet open={isOpen} onOpenChange={setIsOpen}>\r\n                            <SheetTrigger asChild>\r\n                                <Button variant=\"ghost\" size=\"icon\" className=\"h-9 w-9\">\r\n                                    <Menu className=\"w-5 h-5\" />\r\n                                </Button>\r\n                            </SheetTrigger>\r\n                            <SheetContent side=\"left\" className=\"p-0 w-72\">\r\n                                <SidebarContent navItems={navItems} pathname={pathname} onNavigate={() => setIsOpen(false)} />\r\n                            </SheetContent>\r\n                        </Sheet>\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <Shield className=\"w-5 h-5 text-primary\" />\r\n                            <span className=\"font-semibold\">ç®¡ç†åå°</span>\r\n                        </div>\r\n                    </div>\r\n                    <Link \r\n                        to=\"/\" \r\n                        className=\"text-xs text-muted-foreground hover:text-primary transition-colors flex items-center gap-1\"\r\n                    >\r\n                        <ArrowLeft className=\"w-3 h-3\" />\r\n                        å‰å°\r\n                    </Link>\r\n                </header>\r\n\r\n                <main ref={mainRef} className=\"flex-1 overflow-auto\">\r\n                    <div className=\"container mx-auto p-4 md:p-6 lg:p-8 max-w-7xl\">\r\n                        <Outlet />\r\n                    </div>\r\n                </main>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\components\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\components\\plaza\\SoulCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\components\\room\\RoomChat.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\components\\room\\RoomCreate.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\components\\room\\RoomJoin.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\components\\room\\RoomReport.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\components\\room\\RoomSubmit.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\components\\room\\ScenarioSubmit.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\components\\room\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\components\\ui\\Badge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\components\\ui\\Button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\components\\ui\\Card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\components\\ui\\ConfirmDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\components\\ui\\EmptyState.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\components\\ui\\Input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\components\\ui\\InputDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\components\\ui\\Select.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\components\\ui\\Sheet.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\components\\ui\\Skeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\components\\ui\\Textarea.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\components\\ui\\Toast.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\components\\ui\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\lib\\amap.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\lib\\api.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\lib\\auth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\lib\\crypto.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\lib\\diary.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\lib\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\lib\\keyManagement.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\lib\\lifegraph.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\lib\\location.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\lib\\plaza.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\lib\\room.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\lib\\stats.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\pages\\About.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\pages\\Community.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\pages\\Contact.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\pages\\Diary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\pages\\Emotion.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\pages\\History.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\pages\\Home.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\pages\\Login.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\pages\\Match.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\pages\\Messages.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\pages\\Plaza.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\pages\\Privacy.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\pages\\Register.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\pages\\Room.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'room.createdAt'. Either include it or remove the dependency array.","line":76,"column":6,"nodeType":"ArrayExpression","endLine":76,"endColumn":45,"suggestions":[{"desc":"Update the dependencies array to be: [code, room?.status, report, fetchRoom, room.createdAt]","fix":{"range":[3072,3111],"text":"[code, room?.status, report, fetchRoom, room.createdAt]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useParams } from 'react-router-dom'\r\nimport { useEffect, useState, useRef, useCallback } from 'react'\r\nimport { RoomSubmit, RoomReport, RoomChat } from '../components/room'\r\nimport { getReport, getRoom, cancelRoom, startRoom, voteCancelRoom, getScenarios } from '../lib'\r\nimport { useRoomStore } from '../stores'\r\nimport { Card, CardContent, CardHeader, CardTitle, Badge, Button, ConfirmDialog } from '../components/ui'\r\nimport { toast } from 'sonner'\r\nimport type { PersonalSketch, PairCompatibility, RoomScenario } from '../lib'\r\nimport { Play, Copy, Users, CheckCircle2, Clock, AlertCircle, Shuffle, CheckSquare, Square, Sparkles, Timer } from 'lucide-react'\r\nimport * as Tabs from '@radix-ui/react-tabs'\r\nimport { cn } from '../utils'\r\n\r\nexport const Room = () => {\r\n  const { code } = useParams<{ code: string }>()\r\n  const room = useRoomStore((s) => s.rooms[code!])\r\n  const setRoom = useRoomStore((s) => s.setRoom)\r\n  const [report, setReport] = useState<{\r\n    personal: PersonalSketch[];\r\n    pairs: PairCompatibility[];\r\n    publicSubmissions?: { userId: string; content: string }[];\r\n  } | null>(null)\r\n  const [scenarios, setScenarios] = useState<RoomScenario[]>([])\r\n  const userId = localStorage.getItem('yusi-user-id') || ''\r\n  const timerRef = useRef<ReturnType<typeof setInterval> | null>(null)\r\n  const [starting, setStarting] = useState(false)\r\n  const [selectedScenarioId, setSelectedScenarioId] = useState<string>('')\r\n  const [randomPool, setRandomPool] = useState<string[]>([])\r\n  const [confirmDialog, setConfirmDialog] = useState<{\r\n    isOpen: boolean\r\n    title: string\r\n    description: string\r\n    variant: 'primary' | 'danger'\r\n    action: () => Promise<void>\r\n  }>({\r\n    isOpen: false,\r\n    title: '',\r\n    description: '',\r\n    variant: 'primary',\r\n    action: async () => { },\r\n  })\r\n  const [countdown, setCountdown] = useState<number | null>(null)\r\n  const [scenarioExpanded, setScenarioExpanded] = useState(false)\r\n\r\n  const fetchRoom = useCallback(async () => {\r\n    if (!code) return\r\n    try {\r\n      const data = await getRoom(code)\r\n      setRoom(code, data)\r\n    } catch (e) {\r\n      console.error(e)\r\n    }\r\n  }, [code, setRoom])\r\n\r\n  useEffect(() => {\r\n    getScenarios().then((data) => {\r\n      setScenarios(data)\r\n      if (data.length > 0) {\r\n        setRandomPool(data.map(s => s.id))\r\n        setSelectedScenarioId(data[0].id)\r\n      }\r\n    }).catch(console.error)\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    fetchRoom()\r\n    const isExpired = room?.status === 'WAITING' && room?.createdAt && (Date.now() - new Date(room.createdAt).getTime() >= 600 * 1000)\r\n    const effectiveStatus = isExpired ? 'CANCELLED' : room?.status\r\n\r\n    // Only poll if room is not completed or cancelled, OR if completed but report is missing (analyzing)\r\n    if ((effectiveStatus !== 'COMPLETED' && effectiveStatus !== 'CANCELLED') || (effectiveStatus === 'COMPLETED' && !report)) {\r\n      timerRef.current = setInterval(fetchRoom, 2000)\r\n    }\r\n    return () => {\r\n      if (timerRef.current) clearInterval(timerRef.current)\r\n    }\r\n  }, [code, room?.status, report, fetchRoom])\r\n\r\n  useEffect(() => {\r\n    if (!code) return\r\n    if (room?.status === 'COMPLETED' && !report) {\r\n      getReport(code).then((r) => setReport({\r\n        personal: r.personal,\r\n        pairs: r.pairs,\r\n        publicSubmissions: r.publicSubmissions\r\n      }))\r\n    }\r\n  }, [code, room?.status, report])\r\n\r\n  // Countdown timer for WAITING rooms (10 minutes = 600 seconds)\r\n  useEffect(() => {\r\n    if (room?.status !== 'WAITING' || !room?.createdAt) {\r\n      setCountdown(null)\r\n      return\r\n    }\r\n\r\n    const updateCountdown = () => {\r\n      const createdTime = new Date(room.createdAt!).getTime()\r\n      const now = Date.now()\r\n      const elapsed = Math.floor((now - createdTime) / 1000)\r\n      const remaining = 600 - elapsed // 10 minutes in seconds\r\n\r\n      if (remaining <= 0) {\r\n        setCountdown(0)\r\n        // Force refresh when timer expires\r\n        fetchRoom()\r\n      } else {\r\n        setCountdown(remaining)\r\n      }\r\n    }\r\n\r\n    updateCountdown()\r\n    const timer = setInterval(updateCountdown, 1000)\r\n    return () => clearInterval(timer)\r\n  }, [room?.status, room?.createdAt, fetchRoom])\r\n\r\n  const handleCancel = () => {\r\n    if (!code || !userId) return\r\n    setConfirmDialog({\r\n      isOpen: true,\r\n      title: 'è§£æ•£æˆ¿é—´',\r\n      description: 'ç¡®å®šè¦è§£æ•£æˆ¿é—´å—ï¼Ÿè§£æ•£åæ‰€æœ‰æˆå‘˜å°†ç¦»å¼€æˆ¿é—´ã€‚',\r\n      variant: 'danger',\r\n      action: async () => {\r\n        try {\r\n          await cancelRoom(code, userId)\r\n          toast.success('æˆ¿é—´å·²è§£æ•£')\r\n          setConfirmDialog(prev => ({ ...prev, isOpen: false }))\r\n          window.location.href = '/'\r\n        } catch {\r\n          toast.error('è§£æ•£å¤±è´¥')\r\n        }\r\n      },\r\n    })\r\n  }\r\n\r\n  const handleVoteCancel = () => {\r\n    if (!code || !userId) return\r\n    setConfirmDialog({\r\n      isOpen: true,\r\n      title: 'æŠ•ç¥¨è§£æ•£æˆ¿é—´',\r\n      description: 'ç¡®å®šè¦æŠ•ç¥¨è§£æ•£æˆ¿é—´å—ï¼Ÿå½“è¶…è¿‡åŠæ•°æˆå‘˜æŠ•ç¥¨åï¼Œæˆ¿é—´å°†è¢«è§£æ•£ã€‚',\r\n      variant: 'danger',\r\n      action: async () => {\r\n        try {\r\n          await voteCancelRoom(code, userId)\r\n          toast.success('å·²æŠ•ç¥¨')\r\n          setConfirmDialog(prev => ({ ...prev, isOpen: false }))\r\n          fetchRoom()\r\n        } catch {\r\n          toast.error('æŠ•ç¥¨å¤±è´¥')\r\n        }\r\n      },\r\n    })\r\n  }\r\n\r\n  const copyCode = () => {\r\n    navigator.clipboard.writeText(code || '')\r\n    toast.success('æˆ¿é—´å·å·²å¤åˆ¶')\r\n  }\r\n\r\n  const handleStart = async (targetScenarioId?: string) => {\r\n    if (!code || !userId) return\r\n    if (room.members.length < 2) {\r\n      toast.error('è‡³å°‘éœ€è¦2äººæ‰èƒ½å¼€å§‹')\r\n      return\r\n    }\r\n    if (scenarios.length === 0) {\r\n      toast.error('æ²¡æœ‰å¯ç”¨çš„æƒ…æ™¯')\r\n      return\r\n    }\r\n    const finalId = targetScenarioId || selectedScenarioId\r\n    if (!finalId) {\r\n      toast.error('è¯·é€‰æ‹©ä¸€ä¸ªæƒ…æ™¯')\r\n      return\r\n    }\r\n\r\n    setStarting(true)\r\n    try {\r\n      await startRoom({ code, scenarioId: finalId, ownerId: userId })\r\n      toast.success('æˆ¿é—´å·²å¼€å§‹')\r\n      fetchRoom()\r\n    } catch {\r\n      toast.error('å¯åŠ¨å¤±è´¥')\r\n    } finally {\r\n      setStarting(false)\r\n    }\r\n  }\r\n\r\n  const handleRandomStart = () => {\r\n    if (randomPool.length === 0) {\r\n      toast.error('éšæœºæ± ä¸ºç©ºï¼Œè¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªæƒ…æ™¯')\r\n      return\r\n    }\r\n    const randomId = randomPool[Math.floor(Math.random() * randomPool.length)]\r\n    handleStart(randomId)\r\n  }\r\n\r\n  const toggleFromPool = (id: string) => {\r\n    setRandomPool(prev =>\r\n      prev.includes(id) ? prev.filter(p => p !== id) : [...prev, id]\r\n    )\r\n  }\r\n\r\n  const toggleAllPool = () => {\r\n    if (randomPool.length === scenarios.length) {\r\n      setRandomPool([])\r\n    } else {\r\n      setRandomPool(scenarios.map(s => s.id))\r\n    }\r\n  }\r\n\r\n\r\n  if (!room) {\r\n    return (\r\n      <div className=\"flex h-[50vh] flex-col items-center justify-center text-muted-foreground gap-4\">\r\n        <div className=\"text-lg\">æ­£åœ¨å¯»æ‰¾æˆ¿é—´ä¿¡æ¯...</div>\r\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  // Polling / Waiting State\r\n  if (room.status === 'COMPLETED' && !report) {\r\n    return (\r\n      <div className=\"container mx-auto max-w-4xl py-8 px-4\">\r\n        <Card className=\"border-2 border-dashed border-primary/20\">\r\n          <CardContent className=\"flex flex-col items-center justify-center py-20 space-y-6\">\r\n            <div className=\"relative\">\r\n              <div className=\"absolute inset-0 bg-primary/20 rounded-full animate-ping\"></div>\r\n              <Sparkles className=\"relative w-16 h-16 text-primary animate-pulse\" />\r\n            </div>\r\n            <div className=\"text-center space-y-2\">\r\n              <h2 className=\"text-2xl font-bold\">å…¨å‘˜å·²æäº¤ï¼Œæ­£åœ¨ç”Ÿæˆåˆ†ææŠ¥å‘Š...</h2>\r\n              <p className=\"text-muted-foreground\">AI æ­£åœ¨é˜…è¯»å¤§å®¶çš„æ•…äº‹ï¼Œè¯·ç¨å€™ï¼ˆé¢„è®¡ 30ç§’ï¼‰</p>\r\n            </div>\r\n            <Button variant=\"outline\" onClick={fetchRoom}>æ‰‹åŠ¨åˆ·æ–°</Button>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  const isExpired = room.status === 'WAITING' && room.createdAt && (Date.now() - new Date(room.createdAt).getTime() >= 600 * 1000)\r\n  const effectiveStatus = isExpired ? 'CANCELLED' : room.status\r\n\r\n  // CANCELLED rooms now show full page with chat history instead of simple message\r\n  const isCancelled = effectiveStatus === 'CANCELLED'\r\n\r\n  const submitted = room.submissions[userId]\r\n\r\n  const isOwner = room.ownerId === userId\r\n\r\n  return (\r\n    <div className=\"space-y-4 md:space-y-6 max-w-5xl mx-auto\">\r\n      {/* Header Section */}\r\n      <div className=\"flex flex-col gap-3 md:flex-row md:items-center md:justify-between\">\r\n        <div className=\"flex items-center justify-between w-full md:w-auto\">\r\n          <div className=\"flex items-center gap-2 md:gap-3\">\r\n            <h2 className=\"text-2xl md:text-3xl font-bold tracking-tight\">æˆ¿é—´ {code}</h2>\r\n            <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8 md:h-10 md:w-10\" onClick={copyCode} title=\"å¤åˆ¶æˆ¿é—´å·\">\r\n              <Copy className=\"w-4 h-4\" />\r\n            </Button>\r\n          </div>\r\n          {/* Mobile Status Badge */}\r\n          <div className=\"md:hidden\">\r\n            <Badge\r\n              variant={\r\n                effectiveStatus === 'WAITING' ? 'secondary' :\r\n                  effectiveStatus === 'IN_PROGRESS' ? 'default' :\r\n                    'outline'\r\n              }\r\n              className=\"text-xs px-2 py-0.5\"\r\n            >\r\n              {effectiveStatus === 'WAITING' && 'ç­‰å¾…ä¸­'}\r\n              {effectiveStatus === 'IN_PROGRESS' && 'è¿›è¡Œä¸­'}\r\n              {effectiveStatus === 'COMPLETED' && 'å·²å®Œæˆ'}\r\n              {effectiveStatus === 'CANCELLED' && 'å·²è§£æ•£'}\r\n            </Badge>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"flex flex-wrap gap-2 items-center w-full md:w-auto\">\r\n          {/* Countdown Timer for WAITING rooms */}\r\n          {effectiveStatus === 'WAITING' && countdown !== null && (\r\n            <div className={cn(\r\n              \"flex items-center gap-1.5 px-3 py-1 rounded-full text-sm font-medium\",\r\n              countdown <= 60\r\n                ? \"bg-destructive/10 text-destructive animate-pulse\"\r\n                : countdown <= 180\r\n                  ? \"bg-amber-500/10 text-amber-600 dark:text-amber-400\"\r\n                  : \"bg-muted text-muted-foreground\"\r\n            )}>\r\n              <Timer className=\"w-4 h-4\" />\r\n              <span>{Math.floor(countdown / 60)}:{String(countdown % 60).padStart(2, '0')}</span>\r\n              {countdown <= 60 && <span className=\"hidden md:inline\">å³å°†è§£æ•£</span>}\r\n            </div>\r\n          )}\r\n          {effectiveStatus === 'WAITING' && isOwner && (\r\n            <div className=\"grid grid-cols-1 w-full md:flex md:w-auto\">\r\n              <Button variant=\"danger\" size=\"sm\" onClick={handleCancel} className=\"w-full md:w-auto\">\r\n                è§£æ•£æˆ¿é—´\r\n              </Button>\r\n            </div>\r\n          )}\r\n\r\n          {effectiveStatus === 'IN_PROGRESS' && (\r\n            <div className=\"flex flex-wrap gap-2 w-full md:w-auto items-center\">\r\n              {isOwner ? (\r\n                <Button variant=\"danger\" size=\"sm\" onClick={handleCancel} className=\"flex-1 md:flex-none\">\r\n                  å¼ºåˆ¶è§£æ•£\r\n                </Button>\r\n              ) : (\r\n                <Button variant=\"outline\" size=\"sm\" onClick={handleVoteCancel} disabled={room.cancelVotes?.includes(userId)} className=\"flex-1 md:flex-none\">\r\n                  {room.cancelVotes?.includes(userId) ? 'å·²æŠ•ç¥¨' : 'æŠ•ç¥¨è§£æ•£'}\r\n                </Button>\r\n              )}\r\n              {room.cancelVotes && room.cancelVotes.length > 0 && (\r\n                <span className=\"text-xs text-muted-foreground whitespace-nowrap ml-auto md:ml-0\">\r\n                  è§£æ•£æŠ•ç¥¨: {room.cancelVotes.length}/{Math.floor(room.members.length / 2) + 1}\r\n                </span>\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          {/* Desktop Status Badge */}\r\n          <div className=\"hidden md:block\">\r\n            <Badge\r\n              variant={\r\n                effectiveStatus === 'WAITING' ? 'secondary' :\r\n                  effectiveStatus === 'IN_PROGRESS' ? 'default' :\r\n                    'outline'\r\n              }\r\n              className=\"text-sm px-3 py-1\"\r\n            >\r\n              {effectiveStatus === 'WAITING' && 'ç­‰å¾…ä¸­'}\r\n              {effectiveStatus === 'IN_PROGRESS' && 'è¿›è¡Œä¸­'}\r\n              {effectiveStatus === 'COMPLETED' && 'å·²å®Œæˆ'}\r\n              {effectiveStatus === 'CANCELLED' && 'å·²è§£æ•£'}\r\n            </Badge>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* CANCELLED Room Banner */}\r\n      {isCancelled && (\r\n        <Card className=\"border-destructive/50 bg-destructive/5\">\r\n          <CardContent className=\"flex flex-col md:flex-row items-center justify-between gap-4 p-4 md:p-6\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <AlertCircle className=\"w-6 h-6 text-destructive\" />\r\n              <div>\r\n                <p className=\"font-medium text-destructive\">æˆ¿é—´å·²è¢«è§£æ•£</p>\r\n                <p className=\"text-sm text-muted-foreground\">ä½ ä»å¯ä»¥æŸ¥çœ‹ä¹‹å‰çš„èŠå¤©è®°å½•</p>\r\n              </div>\r\n            </div>\r\n            <Button variant=\"outline\" onClick={() => window.location.href = '/'}>è¿”å›é¦–é¡µ</Button>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {effectiveStatus === 'IN_PROGRESS' && room.scenario && (\r\n        <Card className=\"bg-primary/5 border-primary/20\">\r\n          <CardHeader className=\"p-4 md:p-6\">\r\n            <CardTitle className=\"text-lg md:text-xl\">{room.scenario.title}</CardTitle>\r\n          </CardHeader>\r\n          <CardContent className=\"p-4 md:p-6 pt-0 md:pt-0\">\r\n            {scenarioExpanded ? (\r\n              <div className=\"space-y-3\">\r\n                <p className=\"whitespace-pre-wrap text-sm md:text-base leading-relaxed\">{room.scenario.description}</p>\r\n                <Button\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  onClick={() => setScenarioExpanded(false)}\r\n                  className=\"text-xs text-muted-foreground hover:text-foreground\"\r\n                >\r\n                  æ”¶èµ·\r\n                </Button>\r\n              </div>\r\n            ) : (\r\n              <div className=\"space-y-3\">\r\n                <p className=\"whitespace-pre-wrap text-sm md:text-base leading-relaxed\">\r\n                  {room.scenario.summary || room.scenario.description.substring(0, 80) + '...'}\r\n                </p>\r\n                {room.scenario.description && room.scenario.description.length > 80 && (\r\n                  <Button\r\n                    variant=\"outline\"\r\n                    size=\"sm\"\r\n                    onClick={() => setScenarioExpanded(true)}\r\n                    className=\"text-xs\"\r\n                  >\r\n                    å±•å¼€å…¨æ–‡\r\n                  </Button>\r\n                )}\r\n              </div>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {effectiveStatus === 'WAITING' && isOwner && (\r\n        <Card>\r\n          <CardHeader className=\"p-4 md:p-6 pb-2 md:pb-4\">\r\n            <CardTitle className=\"text-base md:text-lg flex items-center gap-2\">\r\n              <Play className=\"w-4 h-4 md:w-5 md:h-5\" />\r\n              æ¸¸æˆè®¾ç½®\r\n            </CardTitle>\r\n          </CardHeader>\r\n          <CardContent className=\"p-4 md:p-6 pt-0\">\r\n            <Tabs.Root defaultValue=\"select\" className=\"w-full\">\r\n              <Tabs.List className=\"flex w-full rounded-lg bg-secondary p-1 text-muted-foreground mb-4\">\r\n                <Tabs.Trigger value=\"select\" className=\"flex-1 inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\">\r\n                  æŒ‡å®šæƒ…æ™¯\r\n                </Tabs.Trigger>\r\n                <Tabs.Trigger value=\"random\" className=\"flex-1 inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\">\r\n                  éšæœºæŠ½å–\r\n                </Tabs.Trigger>\r\n              </Tabs.List>\r\n\r\n              <Tabs.Content value=\"select\" className=\"space-y-4\">\r\n                <div className=\"grid gap-2 max-h-[300px] overflow-y-auto pr-1\">\r\n                  {scenarios.map(s => (\r\n                    <div\r\n                      key={s.id}\r\n                      onClick={() => setSelectedScenarioId(s.id)}\r\n                      className={cn(\r\n                        \"flex flex-col gap-1 p-3 rounded-lg border cursor-pointer transition-colors hover:bg-muted/50 text-left\",\r\n                        selectedScenarioId === s.id ? \"border-primary bg-primary/5 ring-1 ring-primary\" : \"border-transparent bg-secondary/30\"\r\n                      )}\r\n                    >\r\n                      <div className=\"font-medium text-sm\">{s.title}</div>\r\n                      <div className=\"text-xs text-muted-foreground line-clamp-2\">{s.description}</div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n                <Button\r\n                  className=\"w-full\"\r\n                  onClick={() => handleStart()}\r\n                  disabled={room.members.length < 2 || !selectedScenarioId}\r\n                  isLoading={starting}\r\n                >\r\n                  <Play className=\"w-4 h-4 mr-2\" /> å¼€å§‹æ¸¸æˆ\r\n                </Button>\r\n              </Tabs.Content>\r\n\r\n              <Tabs.Content value=\"random\" className=\"space-y-4\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <span className=\"text-sm text-muted-foreground\">éšæœºæ±  ({randomPool.length}/{scenarios.length})</span>\r\n                  <Button variant=\"ghost\" size=\"sm\" onClick={toggleAllPool} className=\"h-8 text-xs\">\r\n                    {randomPool.length === scenarios.length ? 'å…¨ä¸é€‰' : 'å…¨é€‰'}\r\n                  </Button>\r\n                </div>\r\n                <div className=\"grid gap-2 max-h-[250px] overflow-y-auto pr-1\">\r\n                  {scenarios.map(s => {\r\n                    const isSelected = randomPool.includes(s.id)\r\n                    return (\r\n                      <div\r\n                        key={s.id}\r\n                        onClick={() => toggleFromPool(s.id)}\r\n                        className=\"flex items-center gap-3 p-3 rounded-lg border border-transparent bg-secondary/30 cursor-pointer hover:bg-muted/50\"\r\n                      >\r\n                        {isSelected ?\r\n                          <CheckSquare className=\"w-4 h-4 text-primary shrink-0\" /> :\r\n                          <Square className=\"w-4 h-4 text-muted-foreground shrink-0\" />\r\n                        }\r\n                        <div className=\"flex flex-col min-w-0 text-left\">\r\n                          <div className=\"font-medium text-sm truncate\">{s.title}</div>\r\n                        </div>\r\n                      </div>\r\n                    )\r\n                  })}\r\n                </div>\r\n                <Button\r\n                  className=\"w-full\"\r\n                  onClick={handleRandomStart}\r\n                  disabled={room.members.length < 2 || randomPool.length === 0}\r\n                  isLoading={starting}\r\n                >\r\n                  <Shuffle className=\"w-4 h-4 mr-2\" /> éšæœºå¼€å§‹\r\n                </Button>\r\n              </Tabs.Content>\r\n            </Tabs.Root>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      <Card>\r\n        <CardHeader className=\"p-4 md:p-6 pb-2 md:pb-6\">\r\n          <CardTitle className=\"text-base md:text-lg flex items-center gap-2\">\r\n            <Users className=\"w-4 h-4 md:w-5 md:h-5\" />\r\n            æˆå‘˜ ({room.members.length}/8)\r\n          </CardTitle>\r\n        </CardHeader>\r\n        <CardContent className=\"p-4 md:p-6 pt-2 md:pt-0\">\r\n          <div className=\"grid grid-cols-2 sm:grid-cols-3 md:flex md:flex-wrap gap-2 md:gap-4\">\r\n            {room.members.map((m) => {\r\n              const hasSubmitted = !!room.submissions[m]\r\n              const name = room.memberNames?.[m] || m\r\n              const isHost = m === room.ownerId\r\n              return (\r\n                <div key={m} className=\"flex items-center gap-2 bg-secondary/50 px-2 py-1.5 md:px-3 md:py-2 rounded-lg border overflow-hidden\">\r\n                  <div className=\"flex flex-col min-w-0\">\r\n                    <span className=\"text-xs md:text-sm font-medium flex items-center gap-1 truncate\">\r\n                      <span className=\"truncate\">{name}</span>\r\n                      {isHost && <Badge variant=\"outline\" className=\"text-[10px] h-3 px-1 shrink-0\">æˆ¿ä¸»</Badge>}\r\n                    </span>\r\n                  </div>\r\n                  {effectiveStatus === 'IN_PROGRESS' && (\r\n                    <div className=\"ml-auto shrink-0\">\r\n                      {hasSubmitted ?\r\n                        <CheckCircle2 className=\"w-3 h-3 md:w-4 md:h-4 text-green-500\" /> :\r\n                        <Clock className=\"w-3 h-3 md:w-4 md:h-4 text-muted-foreground\" />\r\n                      }\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              )\r\n            })}\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {effectiveStatus === 'IN_PROGRESS' && !submitted && (\r\n        <RoomSubmit code={code!} userId={userId} />\r\n      )}\r\n\r\n      {effectiveStatus === 'IN_PROGRESS' && submitted && (\r\n        <Card>\r\n          <CardContent className=\"p-8 text-center text-muted-foreground\">\r\n            <CheckCircle2 className=\"w-12 h-12 mx-auto mb-4 text-green-500/50\" />\r\n            <p>ä½ å·²æäº¤ï¼Œè¯·è€å¿ƒç­‰å¾…å…¶ä»–æˆå‘˜...</p>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {effectiveStatus === 'COMPLETED' && report && (\r\n        <RoomReport\r\n          personal={report.personal}\r\n          pairs={report.pairs}\r\n          publicSubmissions={report.publicSubmissions}\r\n          memberNames={room.memberNames}\r\n          scenario={room.scenario}\r\n        />\r\n      )}\r\n\r\n      <RoomChat roomCode={code!} roomStatus={effectiveStatus as 'WAITING' | 'IN_PROGRESS' | 'COMPLETED' | 'CANCELLED'} memberNames={room.memberNames} />\r\n\r\n      {/* ç¡®è®¤å¼¹çª— */}\r\n      <ConfirmDialog\r\n        isOpen={confirmDialog.isOpen}\r\n        title={confirmDialog.title}\r\n        description={confirmDialog.description}\r\n        variant={confirmDialog.variant}\r\n        confirmText=\"ç¡®å®š\"\r\n        cancelText=\"å–æ¶ˆ\"\r\n        onConfirm={confirmDialog.action}\r\n        onCancel={() => setConfirmDialog(prev => ({ ...prev, isOpen: false }))}\r\n      />\r\n    </div>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\pages\\RoomLobby.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\pages\\Settings.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\pages\\Terms.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\pages\\Timeline.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\pages\\admin\\AdminDashboard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\pages\\admin\\PromptManagement.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\pages\\admin\\ScenarioAudit.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\pages\\admin\\SuggestionManagement.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\pages\\admin\\UserManagement.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\store\\authStore.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\stores\\chatStore.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\stores\\encryptionStore.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\stores\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\stores\\room.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\stores\\themeStore.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\src\\vite-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\tailwind.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\yusi\\frontend\\vite.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]